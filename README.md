# üì¶ Email Attachment Processor
### (YAML + keyring + per-day UID storage + password management)

Email Processor ‚Äî —ç—Ç–æ –Ω–∞–¥—ë–∂–Ω—ã–π, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö –ø–∏—Å–µ–º –ø–æ IMAP:
- —Å–∫–∞—á–∏–≤–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–∏—è
- —Ä–∞—Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç –∏—Ö –ø–æ –ø–∞–ø–∫–∞–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–º—ã
- –∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –ø–∏—Å—å–º–∞
- —Ö—Ä–∞–Ω–∏—Ç UID –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –ø–∏—Å–µ–º –≤ —Ä–∞–∑–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö –ø–æ –¥–∞—Ç–∞–º
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç keyring –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
- **–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–æ–≤—É—é –∫–æ–º–∞–Ω–¥—É: `--clear-passwords`**
---

# üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ø–∞—Ä–æ–ª–µ–º IMAP
- –ü–∞—Ä–æ–ª—å –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∫–æ–¥–µ –∏ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ YAML
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (**Windows Credential Manager**, **macOS Keychain**, **Linux SecretService**)
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–æ–ª—å –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ

### ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `config.yaml`
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–ø–∫–∞–º–∏ –≤—ã–≥—Ä—É–∑–∫–∏
- –ü—Ä–∞–≤–∏–ª–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ —Ç–µ–º–µ –ø–∏—Å—å–º–∞ (`topic_mapping`)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–º–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è–º–∏
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è
- –û–ø—Ü–∏–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è ("–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å / –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å / –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å")

### ‚ö° –ë—ã—Å—Ç—Ä—ã–π –¥–≤—É—Ö—Ñ–∞–∑–Ω—ã–π IMAP Fetch
1. –ë—ã—Å—Ç—Ä—ã–π fetch –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤: `FROM SUBJECT DATE UID`
2. –ü–æ–ª–Ω–æ–µ –ø–∏—Å—å–º–æ (`RFC822`) –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –ø–æ –ª–æ–≥–∏–∫–µ**

### üìÅ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –ø–∏—Å–µ–º
UID –∫–∞–∂–¥–æ–≥–æ –ø–∏—Å—å–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤:

```
processed_uids/YYYY-MM-DD.txt
```

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- üî• –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö UID
- ‚ö° –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –ø–∞–º—è—Ç—å
- üìâ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö —Å–∫–∞—á–∏–≤–∞–Ω–∏–π
- üìÅ —É–¥–æ–±–Ω—É—é —Ä–æ—Ç–∞—Ü–∏—é —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π

---

# ‚ú® –∫–æ–º–∞–Ω–¥–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è–º–∏

```
python email_processor.py --clear-passwords
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞:

### ‚úî —É–¥–∞–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å –∏–∑ keyring
### ‚úî –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ
### ‚úî –ø–æ–ª–µ–∑–Ω–∞ –µ—Å–ª–∏:
- –ø–∞—Ä–æ–ª—å IMAP –ø—Ä–æ—Ç—É—Ö / –±—ã–ª –∏–∑–º–µ–Ω—ë–Ω
- –≤—ã –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –Ω–∞ –¥—Ä—É–≥–æ–π –ø–æ—á—Ç–æ–≤—ã–π —è—â–∏–∫
- –Ω—É–∂–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –±–µ–∑ –∑–∞—Ö–æ–¥–∞ –≤ Credential Manager

---

## üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–º–∞–Ω–¥–∞ `--clear-passwords`

1. –°–∫—Ä–∏–ø—Ç —á–∏—Ç–∞–µ—Ç `imap.user` –∏–∑ `config.yaml`
2. –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:

```
–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø–∞—Ä–æ–ª–∏? [y/N]:
```  

3. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç `y`:
    - –ø–∞—Ä–æ–ª—å `email-vkh-processor / <user>` —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ keyring

4. –°–∫—Ä–∏–ø—Ç –≤—ã–≤–æ–¥–∏—Ç –æ—Ç—á—ë—Ç:

```
–ì–æ—Ç–æ–≤–æ. –£–¥–∞–ª–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: 1
```  

5. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ –æ–±—ã—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å.

---

# ‚ö° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### ‚ö° –≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏
–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–∏—Å—å–º–∞ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ.

### ‚ö° –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ IMAP —Å–µ—Ä–≤–µ—Ä
–ú–∏–Ω–∏–º—É–º IMAP-–æ–ø–µ—Ä–∞—Ü–∏–π, —á–∞—Å—Ç–∏—á–Ω—ã–π fetch.

### ‚ö° –ù–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–∏–π
–ö–∞–∂–¥–æ–µ –≤–ª–æ–∂–µ–Ω–∏–µ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑.

### ‚ö° –ù–µ –¥—É–±–ª–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è: `file_01.pdf`, `file_02.pdf`.

### ‚ö° –ê–±—Å–æ–ª—é—Ç–Ω–∞—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
–ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ 20 —Ä–∞–∑ –ø–æ–¥—Ä—è–¥ ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è.

### ‚ö° –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
UID-—Ñ–∞–π–ª—ã –ø–æ –¥–Ω—è–º –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

---

# ‚öô –ü—Ä–∏–º–µ—Ä config.yaml

```yaml
imap:
  server: "imap.example.com"
  user: "your_email@example.com"
  max_retries: 5
  retry_delay: 3

processing:
  start_days_back: 5
  download_dir: "downloads"
  archive_folder: "INBOX/Processed"
  processed_dir: "processed_uids"
  keep_processed_days: 180
  archive_only_mapped: true
  skip_non_allowed_as_processed: true
  skip_unmapped_as_processed: true

allowed_senders:
  - "client1@example.com"
  - "finance@example.com"
  - "boss@example.com"

topic_mapping:
  ".*–†–æ–∞–¥–º—ç–ø.*": "roadmap"
  "(–û—Ç—á–µ—Ç|–û—Ç—á—ë—Ç).*": "reports"
  "(Invoice|–°—á—ë—Ç|–°—á–µ—Ç).*": "invoices"
  "–ó–∞—è–≤–∫–∞ ‚Ññ\d+": "applications"
```

---

# üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è–º–∏ (–ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –∫–æ–º–∞–Ω–¥)

### ‚ûï –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```
python email_processor.py
```

### üîç –ü—Ä–æ—á–∏—Ç–∞—Ç—å –ø–∞—Ä–æ–ª—å
```python
import keyring
keyring.get_password("email-vkh-processor", "your_email@example.com")
```

### üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –ø–∞—Ä–æ–ª—å (–Ω–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞)
```
python email_processor.py --clear-passwords
```

### ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å –≤—Ä—É—á–Ω—É—é
```python
import keyring
keyring.set_password(
    "email-vkh-processor",
    "your_email@example.com",
    "MY_PASSWORD"
)
```

---

# ‚ñ∂ –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –≤ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ

```
python email_processor.py
```
 
